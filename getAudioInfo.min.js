function e(e,t=1048576){const n=[];for(let r=0,o=Math.min(e.length,t);r<o;r++)n.push(String.fromCharCode(e[r]));return n.join("")}const t={1:"PCM",2:"MS ADPCM",3:"IEEE FLOAT",5:"IBM CVSD",6:"ALAW",7:"MULAW",16:"OKI ADPCM",17:"DVI/IMA ADPCM",18:"MEDIASPACE ADPCM",19:"SIERRA ADPCM",20:"G723 ADPCM",21:"DIGISTD",22:"DIGIFIX",23:"DIALOGIC OKI ADPCM",32:"YAMAHA ADPCM",33:"SONARC",34:"DSPGROUP TRUESPEECH",35:"ECHOSC1",36:"AUDIOFILE AF36",37:"APTX",38:"AUDIOFILE AF10",48:"DOLBY AC2",49:"GSM610",51:"ANTEX ADPCME",52:"CONTROL RES VQLPC",53:"CONTROL RES VQLPC",54:"DIGIADPCM",55:"CONTROL RES CR10",56:"NMS VBXADPCM",57:"CS IMAADPCM (Roland RDAC)",64:"G721 ADPCM",80:"MPEG-1 Layer I, II",85:"MPEG-1 Layer III (MP3)",105:"Xbox ADPCM",512:"CREATIVE ADPCM",514:"CREATIVE FASTSPEECH8",515:"CREATIVE FASTSPEECH10",768:"FM TOWNS SND",4096:"OLIGSM",4097:"OLIADPCM",4098:"OLICELP",4099:"OLISBC",4100:"OLIOPR"},n={IARL:"Archive location",IART:"Original artist",ICMS:"Commissioner",ICMT:"Comment",ICOP:"Copyright",ICRD:"Creation date",ICRP:"Cropped",IDIM:"Dimensions",IDPI:"DPI",IENG:"Engineer",IGNR:"Genre",IKEY:"Keywords",ILGT:"Lightness",IMED:"Medium",INAM:"Name",IPLT:"Colors",IPRD:"Album",ISBJ:"Subject",ISFT:"Software",ISRC:"Supplier",ISRF:"Source",ITCH:"Technician",ITRK:"TrackNum","id3 ":"id3 "};function r(r){console.time("getRIFF");let o={tags:{}};const i=["fmt ","data","LIST"],s=[];let a=12;for(;a<r.length-4;){let t=e(r.slice(a,a+4));if(-1===i.indexOf(t)){a++;continue}let T={id:t,size:r[a+4]+(r[a+5]<<8)+(r[a+6]<<16)+(r[a+7]<<24),pos:a};if(console.log("chunk.size",T.size),a+=8,"LIST"===T.id&&(t=e(r.slice(a,a+4)),"INFO"===t))for(o.tags.container=[],a+=4;a<a+T.size;){const t=e(r.slice(a,a+4)),i=r[a+4]+(r[a+5]<<8)+(r[a+6]<<16)+(r[a+7]<<24),s=n[t];if(!s)break;a+=8,o.tags.container.push({id:s,content:e(r.slice(a,a+i)).replace(/\0/g,"").trim()}),a+=i}s.push(T),a+=T.size}return console.log(s),o={...o,fType:"WAV",audioFormat:t[r[20]+(r[21]<<8)],numChannels:r[22]+(r[23]<<8),srate:r[24]+(r[25]<<8)+(r[26]<<16)+(r[27]<<24),bitsPerSample:r[34]+(r[35]<<8)},console.timeEnd("getRIFF"),o}function o(t){console.time("getVORBIS");let n=[],r=0;for(;r<t.length;){const o=t[r++]+(t[r++]<<8)+(t[r++]<<16)+(t[r++]<<24),i=e(t.slice(r,r+o));r+=o,n.push({vendorString:i});const s=t[r++]+(t[r++]<<8)+(t[r++]<<16)+(t[r++]<<24);let a=0;for(;a<s;){const o=t[r++]+(t[r++]<<8)+(t[r++]<<16)+(t[r++]<<24);let i;try{i=new TextDecoder("UTF-8").decode(t.slice(r,r+o))}catch(n){i=e(t.slice(r,r+o))}r+=o;let s=i.split("=");n.push({id:s[0],content:s[1]}),a++}const T=1&t[r];console.log("framingBit",T)}return console.timeEnd("getVORBIS"),n}const i=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE"];function s(e){console.time("getFLAC");let t={fType:"FLAC",tags:{}},n=4,r=!1;for(;!r;){r=(128&e[n])>>7;const s=127&e[n++],a=i[s],T=(e[n++]<<16)+(e[n++]<<8)+e[n++];console.log("Found BLOCK ",a,T,r),"STREAMINFO"===a?(t.minBlockSize=(e[n++]<<8)+e[n++],t.maxBlockSize=(e[n++]<<8)+e[n++],t.minFrameSize=(e[n++]<<16)+(e[n++]<<8)+e[n++],t.maxFrameSize=(e[n++]<<16)+(e[n++]<<8)+e[n++],t.srate=(e[n++]<<12)+(e[n++]<<4)+((240&e[n])>>4),t.numChannels=1+((14&e[n])>>1),t.bitsPerSample=((1&e[n++])<<4)+((240&e[n])>>4)+1,t.totalSamples=((15&e[n++])<<32)+(e[n++]<<24)+(e[n++]<<16)+(e[n++]<<8)+e[n++],t.MD5=e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16)+e[n++].toString(16),n-=T):"VORBIS_COMMENT"===a?t.tags.vorbis=o(e.slice(n,n+T)):console.log("Unknown BLOCK type",s,a),n+=T}return console.timeEnd("getFLAC"),t}function a(e){console.time("getOGG");let t={fType:"OGG",tags:{}},n=T(e,0,!0);return t={...t,...n},console.timeEnd("getOGG"),t}function T(t,n=0,r){console.log("readOGGpage",n,r);let i={},s={tags:[]};for(;n<t.length-4&&"OggS"!==e(t.slice(n,n+4));)n++;n+=4,i.version=t[n++],i.headerType=t[n++],i.granulePos=new BigUint64Array(t.buffer.slice(n,n+8))[0],n+=8,i.serial=new Uint32Array(t.buffer.slice(n,n+4))[0],n+=4,i.pageSeq=new Uint32Array(t.buffer.slice(n,n+4))[0],n+=4,i.crc32=new Uint32Array(t.buffer.slice(n,n+4))[0],n+=4;const a=t[n++],l=[];for(let e=0;e<a;e++)l.push(t[n++]);i.pageSegments=[];for(let r=0;r<a;r++){const T=t.slice(n,n+l[r]),c=e(t.slice(n+1,n+7));if("vorbis"===c){console.log("vorbis found",t[n]);let r=n;const i=t[r++];if(r+=6,1!==i){if(3===i){let r=[],i=0;for(let o=0;o<a;o++){let s=t.slice(n+i+7,n+i+l[o]);const a=e(s).indexOf("vorbis");if(-1!==a){s=s.slice(0,a-2),r=[...r,...s];break}r=[...r,...s],i+=l[o]-7}s.tags.vorbis=o(r);break}break}0===t[r++]+(t[r++]<<8)+(t[r++]<<16)+(t[r++]<<24)&&(s.numChannels=t[r++],s.srate=new Uint32Array(t.buffer.slice(r,r+4))[0],r+=4,s.maxBitrate=new Int32Array(t.buffer.slice(r,r+4))[0],r+=4,s.bitrate=new Int32Array(t.buffer.slice(r,r+4))[0]/1e3,r+=4,s.minBitrate=new Int32Array(t.buffer.slice(r,r+4))[0],r+=4,s.blocksize0=2**(15&t[r]),s.blocksize1=2**((240&t[r++])>>4),s.framing=(1&t[r])>>7)}else if("pusHea"===c){s.fType="OPUS",s.audioFormat="OPUS";let e=n+8;s.version=t[e++],s.numChannels=t[e++],s.preSkip=new Uint16Array(t.buffer.slice(e,e+2))[0],e+=2,s.srate=new Uint16Array(t.buffer.slice(e,e+2))[0],e+=2,s.outGain=t[e++],s.mappingFamily=t[e++],s.streamCount=t[e++],s.coupledCount=t[e++],s.mapping=t[e++]}else{if("pusTag"===c){let e=n+8;return s.tags.vorbis=o(t.slice(e,e-8+l[r])),s}if("pusPic"===c){console.log("OpusPictureTag");break}console.error("Unknown OGG identification header",c)}n+=l[r],i.pageSegments.push(T)}return r&&(s={...s,...T(t,n,!1)}),s}function l(t){console.time("getMP4");let n={};const r=e(t),o=r.indexOf("mdhd"),i=t[o+4];return n={...n,fType:"MP4",subtype:r.substring(8,12),version:i,numChannels:2,srate:1===i?(t[o+16+8]<<24)+(t[o+17+8]<<16)+(t[o+18+8]<<8)+t[o+19+8]:(t[o+16]<<24)+(t[o+17]<<16)+(t[o+18]<<8)+t[o+19]},console.timeEnd("getMP4"),n}function c(e){console.time("getEBML");let t=4,n=function(){const n=e[t++];if((128&n)>>7)return 127&n;const r=n.toString(2).padStart(8,"0").split("1")[0].length;if(1==r)return(63&n)<<8+e[t++];if(2==r)return(31&n)<<16+e[t++]<<8+e[t++];if(3==r)return(15&n)<<24+e[t++]<<16+e[t++]<<8+e[t++];if(4==r)return(7&n)<<32+e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++];if(5==r)return(3&n)<<40+e[t++]<<32+e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++];if(6==r)return(1&n)<<48+e[t++]<<40+e[t++]<<32+e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++]}();return console.log(n,t),console.timeEnd("getEBML"),{fType:"WEBM",tags:{}}}function E(e){const t={bitrate:-1};let n=0;for(let r=0;r<e.length;r++){if(255===e[r]&&224==(224&e[r+1])){const o=(24&e[r+1])>>3,i=(6&e[r+1])>>1,s=(240&e[r+2])>>4,a=(12&e[r+2])>>2,T=(192&e[r+3])>>6,l=I(o)+" "+u(i);if(-1!==l.indexOf("reserved"))continue;const c=C(s,!1&o?2:1,(l.match(/I/g)||[]).length);if("bad"===c)continue;const E=O(a,o);if("not allowed"===E||"reserved"===E)continue;const S=(2&e[r+2])>>1;let A;A=1===(l.match(/I/g)||[]).length?4*(12*c*1e3/E+S):144*c*1e3/E+S,A=Math.floor(A),1===n&&(t.fType=l,t.bitrate=-1===t.bitrate?c:Math.round((t.bitrate+c)/2),t.srate=E,t.numChannels=R(T)),r+=A-1,n=0}n++}return t}function I(e){return["MPEG Version 2.5","reserved","MPEG Version 2","MPEG Version 1"][e]}function u(e){return["reserved","Layer III","Layer II","Layer I"][e]}function R(e){return["Stereo","Joint Stereo","2 Mono","Mono"][e]}function O(e,t){const n=[3,0,2,1][t];return 0==n?"not allowed":[44100/n,48e3/n,32e3/n,"reserved"][e]}function C(e,t,n){return{0:{1:{1:"free",2:"free",3:"free"},2:{1:"free",2:"free",3:"free"}},1:{1:{1:32,2:32,3:32},2:{1:32,2:8,3:8}},2:{1:{1:64,2:48,3:40},2:{1:48,2:16,3:16}},3:{1:{1:96,2:56,3:48},2:{1:56,2:24,3:24}},4:{1:{1:128,2:64,3:56},2:{1:64,2:32,3:32}},5:{1:{1:160,2:80,3:64},2:{1:80,2:40,3:40}},6:{1:{1:192,2:96,3:80},2:{1:96,2:48,3:48}},7:{1:{1:224,2:112,3:96},2:{1:112,2:56,3:56}},8:{1:{1:256,2:128,3:112},2:{1:128,2:64,3:64}},9:{1:{1:288,2:160,3:128},2:{1:144,2:80,3:80}},10:{1:{1:320,2:192,3:160},2:{1:160,2:96,3:96}},11:{1:{1:352,2:224,3:192},2:{1:176,2:112,3:112}},12:{1:{1:384,2:256,3:224},2:{1:192,2:128,3:128}},13:{1:{1:416,2:320,3:256},2:{1:224,2:144,3:144}},14:{1:{1:448,2:384,3:320},2:{1:256,2:160,3:160}},15:{1:{1:"bad",2:"bad",3:"bad"},2:{1:"bad",2:"bad",3:"bad"}}}[e][t][n]}function S(e){console.time("getID3");let t={ID3v1:P(e),ID3v2:A(e)};return console.timeEnd("getID3"),t}function A(e){let t=0,n=d(e,t,10);if(0!==n.indexOf("ID3")){n=d(e,e.length-1024,e.length-1);let r=n.indexOf("ID3");if(-1===r)return!1;console.log("found at end"),t=e.length-1024+r}let r={version:"ID3v2."+e[t+3]+"."+e[t+4],flags:{unsynchronisation:(128&e[t+5])>>7!=0,extendedHeader:(64&e[t+5])>>6!=0,experimental:(32&e[t+5])>>5!=0,footer:(16&e[t+5])>>4!=0},size:(e[t+6]<<21)+(e[t+7]<<14)+(e[t+8]<<7)+e[t+9],frames:[]};r.flags.extendedHeader&&(r.extendedHeader={size:(e[t+10]<<21)+(e[t+11]<<14)+(e[t+12]<<7)+e[t+13]});const o={3:{TT1:"CONTENTGROUP",TT2:"TITLE",TT3:"SUBTITLE",TP1:"ARTIST",TP1:"BAND",TP1:"CONDUCTOR",TP1:"MIXARTIST",TCM:"COMPOSER",TXT:"LYRICIST",TLA:"LANGUAGE",TCO:"CONTENTTYPE",TAL:"ALBUM",TRK:"TRACKNUM",TPA:"PARTINSET",TRC:"ISRC",TDA:"DATE",TYE:"YEAR",TIM:"TIME",TRD:"RECORDINGDATES",TOR:"ORIGYEAR",TBP:"BPM",TMT:"MEDIATYPE",TFT:"FILETYPE",TCR:"COPYRIGHT",TPB:"PUBLISHER",TEN:"ENCODEDBY",TSS:"ENCODERSETTINGS",TLE:"SONGLEN",TSI:"SIZE",TDY:"PLAYLISTDELAY",TKE:"INITIALKEY",TOT:"ORIGALBUM",TOF:"ORIGFILENAME",TOA:"ORIGARTIST",TOL:"ORIGLYRICIST",TXX:"USERTEXT",WAF:"WWWAUDIOFILE",WAR:"WWWARTIST",WAS:"WWWAUDIOSOURCE",WCM:"WWWCOMMERCIALINFO",WCP:"WWWCOPYRIGHT",WPB:"WWWPUBLISHER",WXX:"WWWUSER",IPL:"INVOLVEDPEOPLE",ULT:"UNSYNCEDLYRICS",COM:"COMMENT",UFI:"UNIQUEFILEID",MCI:"CDID",ETC:"EVENTTIMING",MLL:"MPEGLOOKUP",STC:"SYNCEDTEMPO",SLT:"SYNCEDLYRICS",RVA:"VOLUMEADJ",EQU:"EQUALIZATION",REV:"REVERB",PIC:"PICTURE",GEO:"GENERALOBJECT",CNT:"PLAYCOUNTER",POP:"POPULARIMETER",BUF:"BUFFERSIZE",CRM:"CRYPTEDMETA",CRA:"AUDIOCRYPTO",LNK:"LINKEDINFO"},4:{TIT1:"CONTENTGROUP",TIT2:"TITLE",TIT3:"SUBTITLE",TPE1:"ARTIST",TPE2:"BAND",TPE3:"CONDUCTOR",TPE4:"MIXARTIST",TCOM:"COMPOSER",TEXT:"LYRICIST",TLAN:"LANGUAGE",TCON:"CONTENTTYPE",TALB:"ALBUM",TRCK:"TRACKNUM",TPOS:"PARTINSET",TSRC:"ISRC",TDAT:"DATE",TYER:"YEAR",TIME:"TIME",TRDA:"RECORDINGDATES",TRDC:"RECORDINGTIME",TORY:"ORIGYEAR",TDOR:"ORIGRELEASETIME",TBPM:"BPM",TMED:"MEDIATYPE",TFLT:"FILETYPE",TCOP:"COPYRIGHT",TPUB:"PUBLISHER",TENC:"ENCODEDBY",TSSE:"ENCODERSETTINGS",TLEN:"SONGLEN",TSIZ:"SIZE",TDLY:"PLAYLISTDELAY",TKEY:"INITIALKEY",TOAL:"ORIGALBUM",TOFN:"ORIGFILENAME",TOPE:"ORIGARTIST",TOLY:"ORIGLYRICIST",TSST:"SETSUBTITLE",TMOO:"MOOD",TPRO:"PRODUCEDNOTICE",TDEN:"ENCODINGTIME",TDRL:"RELEASETIME",TDTG:"TAGGINGTIME",TSOA:"ALBUMSORTORDER",TSOP:"PERFORMERSORTORDER",TSOT:"TITLESORTORDER",TXXX:"USERTEXT",WOAF:"WWWAUDIOFILE",WOAR:"WWWARTIST",WOAS:"WWWAUDIOSOURCE",WCOM:"WWWCOMMERCIALINFO",WCOP:"WWWCOPYRIGHT",WPUB:"WWWPUBLISHER",WORS:"WWWRADIOPAGE",WPAY:"WWWPAYMENT",WXXX:"WWWUSER",IPLS:"INVOLVEDPEOPLE",TMCL:"MUSICIANCREDITLIST",TIPL:"INVOLVEDPEOPLE2",USLT:"UNSYNCEDLYRICS",COMM:"COMMENT",USER:"TERMSOFUSE",UFID:"UNIQUEFILEID",MCDI:"CDID",ETCO:"EVENTTIMING",MLLT:"MPEGLOOKUP",SYTC:"SYNCEDTEMPO",SYLT:"SYNCEDLYRICS",RVAD:"VOLUMEADJ",RVA2:"VOLUMEADJ2",EQUA:"EQUALIZATION",EQU2:"EQUALIZATION2",RVRB:"REVERB",APIC:"PICTURE",GEOB:"GENERALOBJECT",PCNT:"PLAYCOUNTER",POPM:"POPULARIMETER",RBUF:"BUFFERSIZE",AENC:"AUDIOCRYPTO",LINK:"LINKEDINFO",POSS:"POSITIONSYNC",COMR:"COMMERCIAL",ENCR:"CRYPTOREG",GRID:"GROUPINGREG",PRIV:"PRIVATE",OWNE:"OWNERSHIP",SIGN:"SIGNATURE",SEEK:"SEEKFRAME",ASPI:"AUDIOSEEKPOINT",TCMP:"COMPOSER",GRP1:"GROUPING",TDRC:"YEAR"}},i=2===e[t+3]?3:4;n=d(e,t,t+r.size);let s=r.extendedHeader?14+r.extendedHeader.size:10;for(t>100&&(e=e.slice(t));s<r.size-10;){const t=n.substr(s,i),a={size:1};if(!o[i][t]){console.log("Unknown frame: "+t+" at pos: "+s+" of "+r.size);break}if(a.id=o[i][t],s+=i,a.size=(e[s]<<21)+(e[s+1]<<14)+(e[s+2]<<7)+e[s+3],s+=4,a.flags={tagAlterPreservation:(128&e[s])>>7!=0,fileAlterPreservation:(64&e[s])>>6!=0,readOnly:(32&e[s])>>5!=0,compression:(128&e[s+1])>>7!=0,encryption:(64&e[s+1])>>6!=0,groupingIdentity:(32&e[s+1])>>5!=0},s+=2,a.content=g(new Uint8Array(e.buffer.slice(s,s+a.size))),s+=a.size,"COMMENT"===a.id)a.content=a.content.substr(4).replace(/\r/g,"<br/>");else if("PICTURE"===a.id){const e=a.content.split("\0");a.mime=e[0];const t=["Other","32x32 file icon","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. lable side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];a.pictureType=t[e[1].charCodeAt(0)],a.description=e[1].substr(1),a.data=e.slice(2).join("\0")}else{if(""===a.content||"\0"===a.content)continue;"\0"===a.content.substr(0,1)&&(a.content=a.content.substr(1))}r.frames.push(a)}return r}function g(e){const t=e[0];if(1===t){const t=(e[1]<<8)+e[2];if(65534===t)return new TextDecoder("UTF-16LE").decode(e.slice(3));if(65279===t)return new TextDecoder("UTF-16BE").decode(e.slice(3));console.log("Undefined BOM",t.toString(16))}let n=1;return t>3&&(n=0),d(e,n,e.length)}function P(e){let t=!1;return t=L(e),t||(t=D(e)),t||(t=M(e)),t}const f=["Blues","Classic rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","Rhythm and Blues","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz & Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound clip","Gospel","Noise","Alternative Rock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native US","Cabaret","New Wave","Psychedelic","Rave","Show tunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock 'n' Roll","Hard rock","Folk","Folk-Rock","National Folk","Swing","Fast Fusion","Bebop","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber music","Sonata","Symphony","Booty bass","Primus","Porn groove","Satire","Slow jam","Club","Tango","Samba","Folklore","Ballad","Power ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum solo","A cappella","Euro-House","Dancehall","Goa","Drum & Bass","Club-House","Hardcore Techno","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian rock","Merengue","Salsa","Thrash Metal","Anime","Jpop","Synthpop","Abstract","Art Rock","Baroque","Bhangra","Big beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math Rock","New Romantic","Nu-Breakz","Post-Punk","Post-Rock","Psytrance","Shoegaze","Space Rock","Trop Rock","World Music","Neoclassical","Audiobook","Audio theatre","Neue Deutsche Welle","Podcast","Indie-Rock","G-Funk","Dubstep","Garage Rock","Psybient"];function M(e){const t=d(e,e.length-128,e.length);if(0!==t.indexOf("TAG"))return!1;const n={version:"ID3v1",title:t.substr(3,30).replace(/\0/g,"").trim(),artist:t.substr(33,30).replace(/\0/g,"").trim(),album:t.substr(63,30).replace(/\0/g,"").trim(),year:t.substr(93,4).replace(/\0/g,"").trim()};return 0===e[e.length-3]&&0!==e[e.length-2]?(n.version="ID3v1.1",n.comment=t.substr(97,28).replace(/\0/g,"").trim(),n.trackNum=e[e.length-2]):n.comment=t.substr(97,30).replace(/\0/g,"").trim(),e[e.length-1]<f.length-1&&(n.genre=f[e[e.length-1]]),n}function D(e){let t=!1;const n=d(e,e.length-128-227,e.length-227);if(0!==n.indexOf("TAG+"))return!1;return t=M(mp),t.enhanced=!0,t.title=n.substr(4,60).replace(/\0/g,"").trim(),t.artist=n.substr(64,60).replace(/\0/g,"").trim(),t.album=n.substr(124,60).replace(/\0/g,"").trim(),t.speed=["unset","slow","medium","fast","hardcore"][e[e.length-128-227+184]],t.genre2=n.substr(185,30).replace(/\0/g,"").trim(),t.startTime=n.substr(215,6).replace(/\0/g,"").trim(),t.endTime=n.substr(221,6).replace(/\0/g,"").trim(),t}function L(e){let t=!1;const n=d(e,e.length-256,e.length-128);return 0===n.indexOf("EXT")&&(t=M(e),t.version="ID3v1.2",t.title+=n.substr(3,30).replace(/\0/g,"").trim(),t.artist+=n.substr(33,30).replace(/\0/g,"").trim(),t.album+=n.substr(63,30).replace(/\0/g,"").trim(),t.comment+=n.substr(93,15).replace(/\0/g,"").trim(),t.genre2=n.substr(108,20).replace(/\0/g,"").trim(),t)}function d(e,t,n){let r=[];for(let o=t;o<n;o++)r.push(String.fromCharCode(e[o]));return r.join("")}function m(t,n){console.time("getAudioInfo");const o=new Uint8Array(t);let i={mime:n,tags:{}},T=e(o,8);return"RIFF"===T.substring(0,4)?i={...i,...r(o)}:"fLaC"===T.substring(0,4)?i={...i,...s(o)}:"OggS"===T.substring(0,4)?i={...i,...a(o)}:26===o[0]&&69===o[1]&&223===o[2]&&163===o[3]?i={...i,...c(o)}:"ID3"===T.substring(0,3)||255===o[0]&&(251===o[1]||243===o[1]||242===o[1])?i={...i,...E(o)}:"ftyp"===T.substring(4,8)?i={...i,...l(o)}:console.error("getAudioInfo found unknown format",e(o,256),n),i.tags={...i.tags,...S(o)},console.timeEnd("getAudioInfo"),console.log(i),i}export{m as getAudioInfo};